<xaiArtifact artifact_id="05644aed-a7bc-4c00-8db2-b0560b1cf8df" artifact_version_id="f9678611-df83-4b55-b59c-74d32bbc355e" title="index.html" contentType="text/html">
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VBO</title>

  <!-- ✅ Google Client ID -->
  <meta name="google-signin-client_id" content="224714556804-81spvp5794l9rfrslif4o27k4u5fr1ig.apps.googleusercontent.com" />

  <style>
    body { 
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; 
      display:flex; 
      align-items:center; 
      justify-content:center; 
      min-height:100vh; 
      margin:0; 
      background:#fafafa;
    }
    .card { 
      width: 420px; 
      padding: 24px; 
      border: 1px solid #e5e7eb; 
      border-radius: 16px; 
      box-shadow: 0 10px 30px rgba(0,0,0,.05); 
      background:white;
    }
    h1 { font-size: 20px; margin: 0 0 8px; }
    p { color:#4b5563; margin: 0 0 16px; }
    #status { font-size: 14px; margin-top: 8px; color:#111827; }
    #gbtn { margin-top: 12px; display:inline-block; }
    .spinner { 
      width:22px; height:22px; 
      border:3px solid #e5e7eb; 
      border-top-color:#111827; 
      border-radius:50%; 
      animation: spin 1s linear infinite; 
      display:inline-block; 
      vertical-align:middle; 
    }
    @keyframes spin { to { transform: rotate(360deg);} }
    .row { display:flex; gap:8px; align-items:center; }
  </style>

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <div class="card">
    <h1>Hold on !!</h1>
    <p>We are loading for you, it may take few seconds..</p>
    <div class="row">
      <span class="spinner" id="spinner"></span>
      <span id="status">Initializing…</span>
    </div>
    <div id="gbtn" aria-label="Sign in with Google" style="min-height:48px"></div>
  </div>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const status = document.getElementById('status');
  const spinner = document.getElementById('spinner');
  const gbtn = document.getElementById('gbtn');

  status.textContent = 'Checking local authorization...';

  const authorizedEmail = localStorage.getItem('authorizedEmail');

  if (authorizedEmail) {
    status.textContent = 'Authorized locally. Logging in...';
    // Perform login success action, e.g., redirect to dashboard
    setTimeout(() => {
      window.location.href = 'report/'; // Assuming success redirects to report page
    }, 1000);
    return;
  }

  status.textContent = 'No local authorization. Initializing Google Sign-In...';

  google.accounts.id.initialize({
    client_id: '224714556804-81spvp5794l9rfrslif4o27k4u5fr1ig.apps.googleusercontent.com',
    callback: handleCredentialResponse
  });

  google.accounts.id.renderButton(
    gbtn,
    { theme: 'outline', size: 'large' }
  );
});

function handleCredentialResponse(response) {
  const status = document.getElementById('status');
  const spinner = document.getElementById('spinner');
  spinner.style.display = 'inline-block'; // Show spinner during processing
  status.textContent = 'Processing sign-in...';

  // Decode JWT to get email
  const jwt = response.credential;
  const payload = JSON.parse(atob(jwt.split('.')[1].replace(/-/g, '+').replace(/_/g, '/')));
  const email = payload.email;

  if (!email.endsWith('@gmail.com')) {
    status.textContent = 'Please use a Gmail account.';
    spinner.style.display = 'none';
    return;
  }

  // Check server
  status.textContent = 'Checking server authorization...';
  // Replace with your actual server API URL
  const serverUrl = 'https://your-server-api.com/check-email'; // Placeholder for server API

  fetch(serverUrl, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email })
  })
  .then(res => res.json())
  .then(data => {
    spinner.style.display = 'none';
    if (data.authorized) {
      localStorage.setItem('authorizedEmail', email);
      status.textContent = 'Authorized. Logging in...';
      // Perform login success action, e.g., redirect to dashboard
      setTimeout(() => {
        window.location.href = 'report/'; // Assuming success redirects to report page
      }, 1000);
    } else {
      status.textContent = 'Not authorized. Redirecting to signup...';
      setTimeout(() => {
        window.location.href = 'signup.html';
      }, 1000);
    }
  })
  .catch(err => {
    spinner.style.display = 'none';
    status.textContent = 'Error: ' + err.message;
  });
}
</script>
</body>
</html>
</xaiArtifact>
